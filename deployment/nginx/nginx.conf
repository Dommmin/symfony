server {
    listen 80;
    server_name _;

    # === API (Symfony headless) ===
    location ~ ^/api(/.*)?$ {
        root /var/www/html/public;

        # Symfony front controller
        try_files $uri /index.php$is_args$args;

        # FastCGI config for PHP-FPM
        include fastcgi_params;
        fastcgi_pass php:9000;

        fastcgi_param SCRIPT_FILENAME /var/www/html/public/index.php;
        fastcgi_param PATH_INFO $fastcgi_path_info;
        fastcgi_param HTTP_PROXY "";
    }

    # === Static Frontend (React) ===
    location / {
        root /usr/share/nginx/html;
        index index.html;

        try_files $uri $uri/ /index.html;
    }

    # Optional: Serve static assets efficiently
    location ~* \.(?:ico|css|js|gif|jpe?g|png|woff2?|ttf|svg|eot|otf|webp)$ {
        access_log off;
        log_not_found off;
        expires 1M;
        add_header Cache-Control "public";
        try_files $uri =404;
    }
}